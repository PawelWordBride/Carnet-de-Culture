<section class="dico">
  <header class="dico-hero">
    <div>
      <p class="dico-meta">üìö Dictionnaire g√©n√©ral ‚Ä¢ Carnet de culture</p>
      <h2 class="dico-title">Dictionnaire g√©n√©ral</h2>
      <p class="dico-lead">Ajoute, retrouve et organise tes d√©finitions (par th√®me, tags, exemples).</p>
    </div>
  </header>

  <div class="dico-toolbar">
    <input id="searchInput" class="dico-input" type="search" placeholder="Rechercher un mot, un tag, une cat√©gorie‚Ä¶" />
    <select id="categoryFilter" class="dico-select">
      <option value="">Toutes les cat√©gories</option>
      <option>Histoire</option>
      <option>G√©ographie</option>
      <option>Sciences</option>
      <option>Droit</option>
      <option>Tech</option>
      <option>Auto</option>
    </select>
    <button id="openAdd" class="dico-btn">+ Ajouter</button>
  </div>

  <div id="addPanel" class="dico-panel" hidden>
    <div class="panel-grid">
      <label>Mot
        <input id="wWord" class="dico-input" type="text" placeholder="Ex: R√©silience" />
      </label>

      <label>Cat√©gorie
        <input id="wCategory" class="dico-input" type="text" placeholder="Ex: G√©ographie / Urbanisme" />
      </label>

      <label>Tags (s√©par√©s par des virgules)
        <input id="wTags" class="dico-input" type="text" placeholder="Ex: eau, ville, climat" />
      </label>

      <label>D√©finition
        <textarea id="wDef" class="dico-textarea" rows="4" placeholder="D√©finition claire et courte‚Ä¶"></textarea>
      </label>

      <label>Exemple
        <textarea id="wExample" class="dico-textarea" rows="3" placeholder="Une phrase d‚Äôexemple‚Ä¶"></textarea>
      </label>

      <label>Synonymes
        <input id="wSyn" class="dico-input" type="text" placeholder="Ex: robustesse, adaptation" />
      </label>

      <label>Source
        <input id="wSource" class="dico-input" type="text" placeholder="Ex: cours, livre, article‚Ä¶" />
      </label>
    </div>

    <div class="panel-actions">
      <button id="saveEntry" class="dico-btn primary">Enregistrer</button>
      <button id="closeAdd" class="dico-btn ghost">Fermer</button>
    </div>
  </div>

  <div id="results" class="dico-grid"></div>
</section>

<style>
  .dico{
    --c1:#27374D; --c2:#526D82; --c3:#9DB2BF; --c4:#DDE6ED;
    --stroke:rgba(39,55,77,.12);
    --shadow:0 12px 30px rgba(0,0,0,.08);
    --shadow-soft:0 10px 24px rgba(0,0,0,.06);
    color:var(--c1);
    max-width:1100px;
    margin:0 auto;
  }

  .dico-hero{
    padding:18px;
    border:1px solid var(--stroke);
    border-radius:22px;
    background:linear-gradient(135deg,var(--c4),rgba(255,255,255,.75));
    box-shadow:var(--shadow);
    margin-bottom:14px;
  }
  .dico-meta{margin:0 0 8px; color:var(--c2); font-weight:700;}
  .dico-title{margin:0 0 8px; font-size:clamp(1.5rem,2.3vw,2rem); letter-spacing:-.02em;}
  .dico-lead{margin:0; line-height:1.6; opacity:.95; max-width:70ch;}

  .dico-toolbar{
    display:flex; flex-wrap:wrap; gap:10px;
    padding:12px;
    border:1px solid rgba(39,55,77,.10);
    border-radius:18px;
    background:rgba(255,255,255,.7);
    box-shadow:var(--shadow-soft);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    margin-bottom:14px;
  }
  .dico-input,.dico-select,.dico-textarea{
    width:100%;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(39,55,77,.14);
    outline:none;
    background:#fff;
    color:var(--c1);
    font-weight:600;
  }
  .dico-input:focus,.dico-select:focus,.dico-textarea:focus{
    border-color:rgba(82,109,130,.55);
    box-shadow:0 0 0 4px rgba(157,178,191,.25);
  }
  #searchInput{flex:1 1 320px;}
  #categoryFilter{flex:0 0 220px;}

  .dico-btn{
    border:1px solid rgba(39,55,77,.14);
    background:#fff;
    color:var(--c1);
    padding:10px 14px;
    border-radius:999px;
    font-weight:900;
    cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.05);
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .dico-btn:hover{transform:translateY(-1px); box-shadow:0 10px 18px rgba(0,0,0,.08);}
  .dico-btn.primary{
    background:linear-gradient(135deg, rgba(39,55,77,.95), rgba(82,109,130,.95));
    color:#fff;
    border-color:transparent;
  }
  .dico-btn.ghost{background:transparent;}

  .dico-panel{
    border:1px solid rgba(39,55,77,.10);
    border-radius:22px;
    background:#fff;
    box-shadow:var(--shadow-soft);
    padding:14px;
    margin-bottom:14px;
  }
  .panel-grid{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr));
    gap:12px;
  }
  .panel-grid label{font-weight:900; color:var(--c2); display:block;}
  .panel-grid label > *{margin-top:6px;}
  .panel-grid textarea{resize:vertical;}
  .panel-grid label:nth-child(4),
  .panel-grid label:nth-child(5){grid-column:1 / -1;}

  .panel-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px;}

  .dico-grid{
    display:grid;
    grid-template-columns:repeat(3, minmax(0,1fr));
    gap:14px;
  }

  .card{
    border:1px solid rgba(39,55,77,.10);
    border-radius:22px;
    background:#fff;
    box-shadow:var(--shadow-soft);
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:160px;
  }
  .card-top{display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
  .card h3{margin:0; font-size:1.05rem; letter-spacing:-.01em;}
  .badge{
    font-size:.82rem;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(221,230,237,.8);
    border:1px solid rgba(39,55,77,.10);
    font-weight:900;
    color:var(--c1);
    white-space:nowrap;
  }
  .card p{margin:0; line-height:1.6; color:rgba(39,55,77,.92);}
  .tags{display:flex; flex-wrap:wrap; gap:8px;}
  .tag{
    font-size:.82rem;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(157,178,191,.22);
    border:1px solid rgba(39,55,77,.10);
    font-weight:900;
    color:var(--c1);
  }
  .card-actions{display:flex; gap:8px; justify-content:flex-end; margin-top:auto;}
  .small{padding:8px 10px; font-size:.9rem; box-shadow:none;}
  .danger{border-color:rgba(200,0,0,.18);}

  @media (max-width: 900px){ .dico-grid{grid-template-columns:1fr 1fr;} .panel-grid{grid-template-columns:1fr;} }
  @media (max-width: 520px){ .dico-grid{grid-template-columns:1fr;} #categoryFilter{flex:1 1 220px;} }
</style>

<script>
  const KEY = "cc_dico_entries_v1";

  const $ = (id) => document.getElementById(id);
  const results = $("results");

  function loadEntries(){
    try { return JSON.parse(localStorage.getItem(KEY)) || []; }
    catch { return []; }
  }

  function saveEntries(entries){
    localStorage.setItem(KEY, JSON.stringify(entries));
  }

  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function normalize(s){
    return (s || "").toString().toLowerCase().trim();
  }

  function render(entries){
    if(!entries.length){
      results.innerHTML = `<div class="card" style="grid-column:1/-1;">
        <div class="card-top"><h3>Aucune entr√©e</h3><span class="badge">Dictionnaire</span></div>
        <p>Ajoute ton premier mot avec ‚Äú+ Ajouter‚Äù.</p>
      </div>`;
      return;
    }

    results.innerHTML = entries.map(e => {
      const tags = (e.tags || []).map(t => `<span class="tag">#${t}</span>`).join("");
      return `
        <article class="card" data-id="${e.id}">
          <div class="card-top">
            <h3>${escapeHtml(e.word)}</h3>
            <span class="badge">${escapeHtml(e.category || "G√©n√©ral")}</span>
          </div>
          <p><strong>D√©finition :</strong> ${escapeHtml(e.def || "")}</p>
          ${e.example ? `<p><strong>Exemple :</strong> ${escapeHtml(e.example)}</p>` : ""}
          ${e.syn ? `<p><strong>Synonymes :</strong> ${escapeHtml(e.syn)}</p>` : ""}
          ${tags ? `<div class="tags">${tags}</div>` : ""}
          <div class="card-actions">
            <button class="dico-btn small danger" onclick="removeEntry('${e.id}')">Supprimer</button>
          </div>
        </article>
      `;
    }).join("");
  }

  function escapeHtml(str){
    return (str || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function applyFilters(){
    const q = normalize($("searchInput").value);
    const cat = normalize($("categoryFilter").value);

    let entries = loadEntries();

    if(cat){
      entries = entries.filter(e => normalize(e.category).includes(cat));
    }

    if(q){
      entries = entries.filter(e => {
        const hay = [
          e.word, e.def, e.category, e.example, e.syn,
          ...(e.tags || [])
        ].map(normalize).join(" ");
        return hay.includes(q);
      });
    }

    // tri alpha
    entries.sort((a,b) => normalize(a.word).localeCompare(normalize(b.word)));
    render(entries);
  }

  function openAddPanel(){
    $("addPanel").hidden = false;
  }
  function closeAddPanel(){
    $("addPanel").hidden = true;
  }

  function clearForm(){
    $("wWord").value = "";
    $("wCategory").value = "";
    $("wTags").value = "";
    $("wDef").value = "";
    $("wExample").value = "";
    $("wSyn").value = "";
    $("wSource").value = "";
  }

  function addEntry(){
    const word = $("wWord").value.trim();
    const def = $("wDef").value.trim();

    if(!word || !def){
      alert("Mot et d√©finition sont obligatoires.");
      return;
    }

    const entry = {
      id: uid(),
      word,
      def,
      category: $("wCategory").value.trim(),
      tags: $("wTags").value
        .split(",")
        .map(t => t.trim())
        .filter(Boolean),
      example: $("wExample").value.trim(),
      syn: $("wSyn").value.trim(),
      source: $("wSource").value.trim(),
      createdAt: new Date().toISOString()
    };

    const entries = loadEntries();
    entries.push(entry);
    saveEntries(entries);

    clearForm();
    closeAddPanel();
    applyFilters();
  }

  function removeEntry(id){
    const entries = loadEntries().filter(e => e.id !== id);
    saveEntries(entries);
    applyFilters();
  }
  window.removeEntry = removeEntry;

  // events
  $("openAdd").addEventListener("click", openAddPanel);
  $("closeAdd").addEventListener("click", closeAddPanel);
  $("saveEntry").addEventListener("click", addEntry);

  $("searchInput").addEventListener("input", applyFilters);
  $("categoryFilter").addEventListener("change", applyFilters);

  // init
  applyFilters();
</script>
