<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Livres - Carnet de Culture</title>

  <style>
    body{font-family:Arial,sans-serif;margin:0;background:#f7f9fc;color:#333;}
    header{background:#27374D;color:#fff;padding:18px 14px;text-align:center;}
    header h1{margin:0 0 8px;font-size:1.6rem;}
    header a{color:#DDE6ED;text-decoration:none;font-weight:700;}
    header a:hover{text-decoration:underline;}
    main{max-width:1000px;margin:0 auto;padding:24px 16px 60px;}

    .intro{
      background:#DDE6ED;border:1px solid rgba(39,55,77,.12);
      border-radius:18px;padding:18px;box-shadow:0 4px 14px rgba(0,0,0,.08);
      margin-bottom:18px;
    }
    .intro h2{margin:0 0 8px;color:#27374D;font-size:1.2rem;}
    .intro p{margin:0;color:#27374D;opacity:.9;line-height:1.4;}
    .hint{margin-top:14px;font-size:.92rem;opacity:.85;color:#27374D;}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin-top:16px;}
    .card{
      text-decoration:none;background:#fff;border-radius:18px;padding:16px;
      border:1px solid rgba(39,55,77,.10);box-shadow:0 4px 14px rgba(0,0,0,.06);
      display:flex;align-items:center;gap:12px;transition:transform .2s ease,box-shadow .2s ease;
      cursor:pointer;color:#27374D;
    }
    .card:hover{transform:translateY(-3px);box-shadow:0 10px 22px rgba(0,0,0,.10);}
    .icon{
      width:46px;height:46px;border-radius:14px;background:#526D82;
      display:flex;align-items:center;justify-content:center;color:#DDE6ED;font-size:1.3rem;flex:0 0 auto;
    }
    .card h3{margin:0 0 6px;font-size:1.05rem;}
    .card p{margin:0;font-size:.92rem;opacity:.85;line-height:1.3;}
    .arrow{margin-left:auto;font-weight:900;opacity:.6;font-size:1.2rem;}

    /* ====== LIBRARY / BOOKSHELF ====== */
    .library{
      margin-top:18px;
      background:#fff;
      border-radius:18px;
      padding:18px;
      border:1px solid rgba(39,55,77,.10);
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .library-head h2{margin:0 0 6px;color:#27374D;}
    .library-head p{margin:0 0 12px;opacity:.85;color:#27374D;}

    .library-controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .library-controls input,
    .library-controls select{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(39,55,77,.16);
      outline:none;
      font-size:.95rem;
      color:#27374D;
      background:#f7f9fc;
    }
    .library-controls input{flex:1; min-width:220px;}
    .library-controls select{min-width:180px; cursor:pointer;}

    .bookshelf{
      position:relative;
      padding:18px 12px 10px;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(82,109,130,.12), rgba(82,109,130,.05));
      border:1px solid rgba(39,55,77,.10);
      overflow:hidden;
    }

    .shelf{
      position:relative;
      padding:12px 10px 20px;
      margin-bottom:18px;
      border-radius:16px;
      background:rgba(221,230,237,.55);
      border:1px solid rgba(39,55,77,.08);
    }

    .shelf::after{
      content:"";
      position:absolute;
      left:10px;
      right:10px;
      bottom:6px;
      height:10px;
      border-radius:12px;
      background:linear-gradient(90deg, rgba(39,55,77,.22), rgba(39,55,77,.10));
    }

    .shelf-row{
      display:flex;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
      padding:6px 8px 14px;
    }

    .book{
      width:110px;
      height:165px;
      border-radius:14px;
      border:1px solid rgba(39,55,77,.18);
      box-shadow:0 10px 18px rgba(0,0,0,.10);
      cursor:pointer;
      position:relative;
      padding:0;
      overflow:hidden;
      background:#526D82;
      transform:translateY(0);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .book:hover{transform:translateY(-6px);box-shadow:0 16px 28px rgba(0,0,0,.16);}

    .book img{width:100%;height:100%;object-fit:cover;display:block;}

    .book .book-overlay{
      position:absolute;left:0; right:0; bottom:0;
      padding:10px 10px;
      background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.65));
      color:#fff;
    }
    .book .book-name{font-weight:800;font-size:.9rem;line-height:1.1;margin:0;}
    .book .book-author{margin:4px 0 0;font-size:.78rem;opacity:.9;}

    /* ====== MODAL + FLIP BOOK ====== */
    .modal{position:fixed;inset:0;display:none;z-index:9999;}
    .modal.is-open{display:block;}
    .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55);backdrop-filter: blur(2px);}
    .modal-panel{
      position:relative;z-index:1;
      width:min(920px, calc(100% - 24px));
      margin:12px auto;background:#fff;border-radius:18px;
      border:1px solid rgba(39,55,77,.12);
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modal-close{
      position:absolute;top:10px;right:10px;
      width:40px;height:40px;border-radius:12px;
      border:1px solid rgba(39,55,77,.14);background:#f7f9fc;
      cursor:pointer;font-size:1.1rem;
    }
    .modal-top{
      padding:18px 18px 10px;
      background:linear-gradient(180deg, rgba(221,230,237,.75), rgba(255,255,255,1));
      border-bottom:1px solid rgba(39,55,77,.10);
    }
    .modal-top h2{margin:0 0 4px;color:#27374D;}
    .modal-sub{margin:0;opacity:.9;color:#27374D;}

    .modal-author-link{color:#27374D;text-decoration:underline;font-weight:700;}
    .modal-category{
      display:inline-block;margin-top:6px;padding:6px 10px;border-radius:999px;
      font-size:.78rem;font-weight:700;letter-spacing:.02em;
      background:#526D82;color:#DDE6ED;opacity:.95;
    }

    .flip-scene{perspective:1200px;padding:18px;}
    .flip-card{
      width:min(420px, 100%);
      height:620px;
      margin:0 auto;
      position:relative;
      transform-style:preserve-3d;
      transition:transform .6s ease;
      cursor:pointer;
    }
    .flip-card.is-flipped{transform:rotateY(180deg);}
    .flip-face{
      position:absolute;inset:0;backface-visibility:hidden;border-radius:18px;overflow:hidden;
      border:1px solid rgba(39,55,77,.12);box-shadow:0 10px 30px rgba(0,0,0,.12);
      background:#fff;
    }
    .flip-front img{width:100%;height:100%;object-fit:cover;display:block;}
    .flip-back{transform:rotateY(180deg);background:#ffffff;}
    .modal-back-content{padding:18px;height:100%;overflow:auto;}
    .modal-back-content h3{margin:0 0 10px;color:#27374D;}
    .modal-back-content p{margin:0 0 10px;line-height:1.55;color:#27374D;opacity:.92;}

    @media (max-width:520px){.flip-card{height:560px;}}
  </style>
</head>

<body>
  <header>
    <h1>üìö Livres</h1>
    <nav><a href="index.html">‚¨Ö Retour au sommaire</a></nav>
  </header>

  <main>
    <section class="intro">
      <h2>Bienvenue dans la section Livres</h2>
      <p>Genres, fiches de lecture, auteurs, ≈ìuvres, citations et analyses.</p>
      <p class="hint">Les cat√©gories ouvrent maintenant leur page directement (plus de fetch).</p>
    </section>

<section class="grid">
  <a class="card" href="pages/livres/categorie.html?genre=romance"><div class="icon">üíò</div><div><h3>Romance</h3><p>Amour, relations, √©motions, variations.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=aventure"><div class="icon">üß≠</div><div><h3>Aventure</h3><p>Qu√™tes, exploration, p√©rip√©ties, h√©ros.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=policier"><div class="icon">üïµÔ∏è</div><div><h3>Policier</h3><p>Enqu√™tes, crimes, suspense, m√©thodes, thriller.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=fantastique"><div class="icon">üïØÔ∏è</div><div><h3>Fantastique</h3><p>√âtrange, inqui√©tant, ambigu, mythes.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=science_fiction"><div class="icon">üöÄ</div><div><h3>Science-fiction</h3><p>Futur, sciences, soci√©t√©s, IA.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=fantasy"><div class="icon">üêâ</div><div><h3>Fantasy</h3><p>Mondes, magie, √©pop√©es, cr√©atures.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=young_adult"><div class="icon">üìó</div><div><h3>Young Adult</h3><p>Parcours, identit√©, √©motions, croissance.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=manga"><div class="icon">üà∂</div><div><h3>Manga</h3><p>S√©ries, univers, styles, th√®mes.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/categorie.html?genre=bd"><div class="icon">üóØÔ∏è</div><div><h3>Bande dessin√©e</h3><p>Auteurs, s√©ries, √©coles, narration.</p></div><span class="arrow">‚Üí</span></a>

  <a class="card" href="pages/livres/categorie.html?genre=citations"><div class="icon">‚ùù</div><div><h3>Citations</h3><p>Extraits marquants, phrases cl√©s, pens√©es d‚Äôauteurs.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/auteurs.html"><div class="icon">‚úçÔ∏è</div><div><h3>Auteurs</h3><p>Fiches auteurs.</p></div><span class="arrow">‚Üí</span></a>
  <a class="card" href="pages/livres/fiches_de_lecture.html"><div class="icon">üßæ</div><div><h3>Fiches de lecture</h3><p>Format d‚Äôanalyse, r√©sum√©s, th√®mes.</p></div><span class="arrow">‚Üí</span></a>
</section>


    <section class="library">
      <div class="library-head">
        <h2>üìö Biblioth√®que</h2>
        <p>Un meuble virtuel : clique sur un livre pour ouvrir sa fiche.</p>

        <div class="library-controls">
          <input id="libSearch" type="search" placeholder="Rechercher un titre / auteur‚Ä¶" autocomplete="off" />
          <select id="libFilter">
            <option value="all">Tous les genres</option>
            <option value="romance">Romance</option>
            <option value="aventure">Aventure</option>
            <option value="policier">Policier</option>
            <option value="fantastique">Fantastique</option>
            <option value="science_fiction">Science-fiction</option>
            <option value="fantasy">Fantasy</option>
            <option value="young_adult">Young Adult</option>
            <option value="manga">Manga</option>
            <option value="bd">BD</option>
          </select>
        </div>
      </div>

      <div id="bookshelf" class="bookshelf" aria-label="Biblioth√®que"></div>
    </section>
  </main>

  <!-- ====== MODAL LIVRE (POPUP + FLIP) ====== -->
  <div class="modal" id="bookModal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>

    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="modal-close" type="button" aria-label="Fermer" data-close="true">‚úï</button>

      <div class="modal-top">
        <h2 id="modalTitle">Livre</h2>
        <p class="modal-sub">
          <a id="modalAuthorLink" class="modal-author-link" href="pages/livres/auteurs.html">Auteur</a>
        </p>

        <p class="modal-category" id="modalCategory"></p>
      </div>

      <div class="flip-scene">
        <div class="flip-card" id="flipCard" aria-label="Cliquer pour retourner le livre">
          <div class="flip-face flip-front">
            <img id="modalCover" src="" alt="Couverture du livre" />
          </div>

          <div class="flip-face flip-back">
            <div class="modal-back-content">
              <h3>R√©sum√©</h3>
              <div id="modalSummary"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    // ====== DATA ======
    let books = [];
    async function loadBooks() {
      const res = await fetch("assets/data/livres.json");
      if (!res.ok) throw new Error("Impossible de charger assets/data/livres.json");
      books = await res.json();
    }

    const GENRE_LABELS = {
      romance: "Romance",
      aventure: "Aventure",
      policier: "Policier",
      fantastique: "Fantastique",
      fantasy: "Fantasy",
      science_fiction: "Science-fiction",
      young_adult: "Young Adult",
      manga: "Manga",
      bd: "Bande dessin√©e",
      litterature: "Litt√©rature"
    };

    // ====== DOM ======
    const bookshelf = document.getElementById("bookshelf");
    const search = document.getElementById("libSearch");
    const filter = document.getElementById("libFilter");

    const modal = document.getElementById("bookModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalCategory = document.getElementById("modalCategory");
    const modalCover = document.getElementById("modalCover");
    const modalSummary = document.getElementById("modalSummary");
    const modalAuthorLink = document.getElementById("modalAuthorLink");
    const flipCard = document.getElementById("flipCard");

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function summaryToHtml(summary) {
      if (Array.isArray(summary)) {
        return summary.map(p => `<p>${escapeHtml(p)}</p>`).join("");
      }
      if (typeof summary === "string" && summary.trim()) {
        return `<p>${escapeHtml(summary)}</p>`;
      }
      return "<p>R√©sum√© non disponible.</p>";
    }

    function chunk(arr, size) {
      const out = [];
      for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));
      return out;
    }

    function renderLibrary(list) {
      bookshelf.innerHTML = "";
      const shelves = chunk(list, 10);

      shelves.forEach(shelfBooks => {
        const shelf = document.createElement("div");
        shelf.className = "shelf";

        const row = document.createElement("div");
        row.className = "shelf-row";

        shelfBooks.forEach(b => {
          const book = document.createElement("button");
          book.type = "button";
          book.className = "book";

          book.innerHTML = `
  <img src="${b.cover || ""}" alt="Couverture ‚Äî ${b.title}">
`;


          book.addEventListener("click", () => openModal(b));
          row.appendChild(book);
        });

        shelf.appendChild(row);
        bookshelf.appendChild(shelf);
      });
    }

    // ====== MODAL ======
    function openModal(book) {
      modalTitle.textContent = book.title || "Livre";

      modalAuthorLink.textContent = book.author || "Auteur";
      modalAuthorLink.href = book.authorUrl || "pages/livres/auteurs.html";

      modalCategory.textContent = GENRE_LABELS[book.genre] || book.genre || "";

      modalCover.src = book.cover || "";
      modalCover.alt = `Couverture ‚Äî ${book.title || "Livre"}`;

      modalSummary.innerHTML = summaryToHtml(book.summary);

      flipCard.classList.remove("is-flipped");
      modal.classList.add("is-open");
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function closeModal() {
      modal.classList.remove("is-open");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    // ‚úÖ clic sur la carte = flip
    flipCard.addEventListener("click", () => {
      flipCard.classList.toggle("is-flipped");
    });

    // ‚úÖ si tu cliques sur le nom de l'auteur, on ferme la popup (et tu vas sur la page)
    modalAuthorLink.addEventListener("click", () => closeModal());

    // ‚úÖ fermeture backdrop / bouton X
    modal.addEventListener("click", (e) => {
      if (e.target && e.target.dataset && e.target.dataset.close === "true") closeModal();
    });

    // ‚úÖ fermeture ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("is-open")) closeModal();
    });

    // ====== FILTERS ======
    function applyFilters() {
      const q = (search.value || "").trim().toLowerCase();
      const g = filter.value;

      const filtered = books.filter(b => {
        const okGenre = (g === "all") || (b.genre === g);
        const blob = `${b.title || ""} ${b.author || ""}`.toLowerCase();
        const okQuery = !q || blob.includes(q);
        return okGenre && okQuery;
      });

      renderLibrary(filtered);
    }

    // ====== INIT ======
    try {
      await loadBooks();
      renderLibrary(books);
    } catch (err) {
      console.error(err);
      bookshelf.innerHTML = `
        <p style="margin:0;color:#27374D;">
          Impossible de charger la biblioth√®que. V√©rifie le fichier
          <strong>assets/data/livres.json</strong> et lance le site via un serveur (Live Server / GitHub Pages).
        </p>
      `;
    }

    search.addEventListener("input", applyFilters);
    filter.addEventListener("change", applyFilters);
  });
  </script>
</body>
</html>
